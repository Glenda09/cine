<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Cartelera</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
<header class="p-3 bg-dark text-white">
    <div class="container d-flex gap-3 align-items-center">
        <h1 class="h4 m-0">Cartelera</h1>
        <a class="text-light" href="/">Inicio</a>
        <a class="text-light" href="/mis-compras">Mis compras</a>
        <a class="text-light" href="/admin" id="linkAdmin" style="display:none">Admin</a>
        <div class="ms-auto d-flex gap-3">
            <a class="btn btn-outline-light btn-sm" href="/login" id="linkLogin">Iniciar sesión</a>
            <a class="btn btn-light btn-sm" href="/register" id="linkRegister">Registrarse</a>
            <a class="btn btn-warning btn-sm" href="/logout" id="linkLogout" style="display:none">Salir</a>
        </div>
    </div>
  </header>
<main class="container py-4">
    <form class="row g-2 mb-3" method="get">
        <div class="col-auto">
            <label class="form-label">Fecha</label>
            <input class="form-control" type="date" name="fecha" th:value="${fecha}">
        </div>
        <div class="col-auto">
            <label class="form-label">Categoría</label>
            <select class="form-select" name="categoria">
                <option th:selected="${categoriaSel==null}" value="">Todas</option>
                <option th:each="c: ${categorias}" th:value="${c.nombre}" th:text="${c.nombre}"
                        th:selected="${categoriaSel == c.nombre}"></option>
            </select>
        </div>
        <div class="col-auto">
            <label class="form-label">Clasificación</label>
            <select class="form-select" name="clasif">
                <option th:selected="${clasifSel==null}" value="">Todas</option>
                <option th:each="cl: ${clasifs}" th:value="${cl}" th:text="${cl}"
                        th:selected="${clasifSel == cl}"></option>
            </select>
        </div>
        <div class="col-auto align-self-end">
            <button class="btn btn-primary" type="submit">Filtrar</button>
        </div>
    </form>

    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
        <div class="col" th:each="p : ${peliculas}">
            <div class="card h-100">
                <img class="card-img-top" th:if="${p.posterUrl}" th:src="${p.posterUrl}" alt="poster" />
                <div class="card-body">
                    <h5 class="card-title" th:text="${p.titulo}">Titulo</h5>
                    <p class="card-text" th:text="${p.sinopsis}">Sinopsis</p>
                </div>
                <div class="card-footer bg-white">
                    <a class="btn btn-sm btn-primary" th:href="@{'/peliculas/' + ${p.id}}">Ver detalle</a>
                </div>
            </div>
        </div>
    </div>
</main>
<script>
  // Mostrar/ocultar enlaces según cookie AUTH
  function hasToken(){ return document.cookie.split('; ').some(x=>x.startsWith('AUTH=')); }
  const logged = hasToken();
  document.getElementById('linkLogin').style.display = logged? 'none':'inline';
  document.getElementById('linkRegister').style.display = logged? 'none':'inline';
  document.getElementById('linkLogout').style.display = logged? 'inline':'none';
  // Mostrar acceso admin si existe cookie
  const linkAdmin = document.getElementById('linkAdmin');
  if (logged && linkAdmin) linkAdmin.style.display = 'inline';
</script>
</body>
</html>
